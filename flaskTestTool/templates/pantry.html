<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GrumpyChef - Pantry</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename= 'css/cartStyles.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename= 'css/pantryStyles.css') }}"
    />
  </head>
  <body>
    <nav class="navbar">
      <!-- Nav toolbar -->
      <div class="nav-brand">
        <!-- GrumpyChef SVG -->
        <svg
          class="logo"
          width="40"
          height="40"
          viewBox="0 0 399 399"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M76.0117 156.886H295.988V324.024H76.0117V156.886Z"
            fill="#D3FAC7"
          />
          <path
            d="M166.59 142.328C166.59 186.1 130.865 221.584 86.7952 221.584C42.7255 221.584 7 186.1 7 142.328C7 98.5564 42.7255 63.0723 86.7952 63.0723C130.865 63.0723 166.59 98.5564 166.59 142.328Z"
            fill="#D3FAC7"
          />
          <path
            d="M265.795 111.596C265.795 155.666 230.07 191.392 186 191.392C141.931 191.392 106.205 155.666 106.205 111.596C106.205 67.5267 141.931 31.8012 186 31.8012C230.07 31.8012 265.795 67.5267 265.795 111.596Z"
            fill="#D3FAC7"
          />
          <path
            d="M365.001 142.328C365.001 186.1 329.275 221.584 285.205 221.584C241.136 221.584 205.41 186.1 205.41 142.328C205.41 98.5563 241.136 63.0722 285.205 63.0722C329.275 63.0722 365.001 98.5563 365.001 142.328Z"
            fill="#D3FAC7"
          />
          <path
            d="M76.0117 312.163H295.988V333.313C295.988 337.116 292.91 340.199 289.113 340.199H82.886C79.0894 340.199 76.0117 337.116 76.0117 333.313V312.163Z"
            fill="#8499B1"
          />
          <path
            d="M141.789 132.806C141.789 127.048 146.375 122.38 152.033 122.38C157.691 122.38 162.277 127.048 162.277 132.806V180.965C162.277 186.724 157.691 191.392 152.033 191.392C146.375 191.392 141.789 186.724 141.789 180.965V132.806Z"
            fill="#8499B1"
          />
          <path
            d="M175.217 132.806C175.217 127.048 180.045 122.38 186 122.38C191.955 122.38 196.783 127.048 196.783 132.806V180.965C196.783 186.724 191.955 191.392 186 191.392C180.045 191.392 175.217 186.724 175.217 180.965V132.806Z"
            fill="#8499B1"
          />
          <path
            d="M209.723 132.806C209.723 127.048 214.309 122.38 219.967 122.38C225.624 122.38 230.211 127.048 230.211 132.806V180.965C230.211 186.724 225.624 191.392 219.967 191.392C214.309 191.392 209.723 186.724 209.723 180.965V132.806Z"
            fill="#8499B1"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M276.804 63.5063C279.565 63.2194 282.368 63.0723 285.205 63.0723C320.759 63.0723 350.882 86.1678 361.196 118.078C358.435 118.365 355.632 118.512 352.795 118.512C317.241 118.512 287.118 95.4165 276.804 63.5063Z"
            fill="#EC9192"
          />
        </svg>
        <span>GrumpyChef</span>
      </div>

      <!-- Nav Links -->
      <div class="nav-links">
        <a href="/home">Home</a>
        <a href="/recipeDisplay">Recipes</a>
        <a href="/pantry" class="active">Pantry</a>
        <a href="/shoppingCart">Carts</a>
      </div>

      <!-- Profile -->
      <div class="nav-profile">
        <a href="profile" class="profile-link">
          <span>Profile</span>

          <!-- Profile Icon SVG -->
          <svg
            class="profile-icon"
            width="30"
            height="30"
            viewBox="0 0 343 333"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M165.926 164.974C197.498 164.974 223.093 140.126 223.093 109.474C223.093 78.8219 197.498 53.9737 165.926 53.9737C134.354 53.9737 108.759 78.8219 108.759 109.474C108.759 140.126 134.354 164.974 165.926 164.974Z"
              stroke="#F3DFA2"
              stroke-width="12.5417"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M230.954 278.61C238.457 278.454 245.788 276.389 252.211 272.62C258.635 268.851 263.927 263.511 267.559 257.134C271.19 250.757 273.034 243.567 272.905 236.281C272.777 228.995 270.68 221.87 266.825 215.617C256.653 200.029 242.586 187.189 225.933 178.293C209.279 169.397 190.58 164.732 171.572 164.732C152.564 164.732 133.864 169.397 117.21 178.293C100.557 187.189 86.4903 200.029 76.3176 215.617C72.4631 221.87 70.3664 228.995 70.2377 236.281C70.1091 243.567 71.9525 250.757 75.584 257.134C79.2156 263.511 84.5078 268.851 90.9316 272.62C97.3554 276.389 104.686 278.454 112.189 278.61H230.954Z"
              stroke="#F3DFA2"
              stroke-width="12.5417"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </a>
      </div>
    </nav>
    <!-- main content here.-->
    <main>
      <div class="container">
        <h1>Pantry</h1>

        <div class="inputPantry">
          <!-- First dropdown menu -->
          <select name="foodCategory" id="foodCategory">
              <option value="fruits">Fruits</option>
              <option value="vegetables">Vegetables</option>
              <option value="dairy">Dairy</option>
              <option value="dry_goods">Dry Goods</option>
              <option value="canned_goods">Canned Goods</option>
              <option value="meat">Meat</option>
              <option value="oil">Oil</option>
          </select>
  
          <!-- Name field -->
          <input type="text" id="name" placeholder="Ingredient" />
  
          <!-- Amount field -->
          <input type="number" id="amount" placeholder="Amount" />
  
          <!-- Second dropdown menu -->
          <select name="units" id="units">
              <option value="kg">Kilograms</option>
              <option value="oz">Ounces</option>
              <option value="liters">Liters</option>
              <option value="grams">Grams</option>
          </select>
  
          <!-- Add to Pantry button -->
          <button id="btn" onclick="addToPantry()">Add to Pantry</button>
      </div>

      <div class="top-div"></div>

      <div class="icon-area" id="iconArea">
      <!-- Icons will be dynamically inserted here -->
      </div>

      <div class="bottom-div"></div>
      
      <!-- Modal (hidden by default) -->
      <div id="editModal" class="modal" style="display:none;">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <h2>Edit Item</h2>
          <label>Name: <input id="editName" type="text"></label><br>
          <label>Amount: <input id="editAmount" type="number"></label><br>
          <label>Units: <input id="editUnits" type="text"></label><br>
          <label>Category: <input id="editCategory" type="text"></label><br>
          <button onclick="saveChanges()">Save</button>
          <button onclick="deleteItem()">Delete</button>
        </div>
      </div>

    </main>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        const userData = JSON.parse(sessionStorage.getItem('userData'));
        if (!userData) {
          // If not logged in, redirect to login page
          window.location.href = '/index';
          return;
        }
        else{
          fetchIngredients()
        }

        // If logged in, initialize pantry functionality    
      });
      try{
        sessionStorage.setItem('currentItemList', []);
      }
      catch (error){
        console.error('Probelm setting sessionStorage with currentItemList', error);
      }

      
      async function addToPantry() {
        //TODO: displayPantry will have to pull from the backend ingredient list and update after the 'addToPantry' button is pushed

        foodCat = document.getElementById("foodCategory").value;
        ingredientName = document.getElementById("name").value;
        ingredientAmount = document.getElementById("amount").value;
        ingredientUnit = document.getElementById("units").value;
        
        json = {
          ingredient: {"category": foodCat, "name": ingredientName, "amount": ingredientAmount, "unit": ingredientUnit}
          };

        
        const userData = JSON.parse(sessionStorage.getItem('userData'));
        const response = await fetch("http://127.0.0.1:5000/pantry/addItem", {
          method: "POST",
          body: JSON.stringify(json),
          headers: {
                'Content-Type': 'application/json',
                'User-Id': userData.id
            }
        });
        fetchIngredients();
        //displayIcons(response);
      }

      async function fetchIngredients() {
      try {
        const userData = JSON.parse(sessionStorage.getItem('userData'));

        const response = await fetch('http://127.0.0.1:5000/pantry/getIngredients', {
            method: "GET",
            headers: {
                'Content-Type': 'application/json',
                'User-Id': userData.id
            } 
      }); 
        const data = await response.json();
        displayIcons(data['ingredients']);
      } catch (error) {
        console.error('Error fetching pantry:', error);
      }
    }

    function displayIcons(icons) {
      try {
        const itemJsonList = [];
        icons.forEach(item => {
          const thisItem = {'name':item.name, 'units':item.units, 'amount':item.amount, 'category':item.category};
          console.log(thisItem);
          itemJsonList.push(thisItem);
        });
        
      }
      catch (error){
        console.error("Failed to convert to json", error);
      }

      const iconArea = document.getElementById('iconArea');
      iconArea.innerHTML = ''; // Clear previous icons
      const fruitIcon = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><svg height="800px" width="800px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 viewBox="0 0 512 512"  xml:space="preserve"><style type="text/css">	.st0{fill:#000000;} </style> <g>	<path class="st0" d="M474.38,192.05c-14.413-36.829-43.215-67.2-80.869-80.423c-40.875-14.34-83.482-6.199-123.938,4.969		c-0.768-22.101,1.101-44.266,4.241-66.149c1.78-12.349,10.301-37.897-10.837-38.771c-17.544-0.728-17.593,22.756-19.301,34.733		c-3.301,22.975-5.251,46.258-4.62,69.483c-9.719-1.618-19.316-5.236-28.996-7.243c-14.437-2.978-29.141-4.839-43.894-4.856		c-28.429,0-56.486,7.534-79.881,23.987c-45.431,31.966-63.122,87.74-62.353,141.328c0.841,58.023,20.49,113.432,53.548,160.758		c14.591,20.895,31.366,40.932,52.1,56.008c20.15,14.647,42.655,21.51,67.087,25.005c10.374,1.498,20.936,1.538,31.277-0.153		c9.031-1.472,17.488-5.284,26.446-6.798c6.766-1.141,16.307,4.184,22.853,5.64c11.16,2.509,22.643,3.027,34.013,1.732		c41.604-4.742,74.565-23.509,101.942-54.973C473.409,387.13,509.291,281.19,474.38,192.05z M446.946,333.962		c-7.696,26.981-19.875,51.647-35.623,74.791c-13.943,20.491-30.104,40.795-50.821,54.794		c-19.026,12.843-44.776,19.859-67.718,17.755c-11.67-1.06-22.295-6.668-33.883-7.769c-12.973-1.221-24.965,5.721-37.614,7.445	c-49.737,6.766-89.018-27.02-115.99-64.464c-33.09-45.95-52.723-100.85-50.854-157.942c1.716-52.318,26.657-106.303,81.112-120.628 c27.24-7.153,55.928-3.042,82.754,3.861c11.613,2.97,23.598,7.793,35.648,8.44c9.274,1.068,19.479-3.172,28.243-5.584 c52.472-14.437,111.547-17.934,148.085,30.104C464.03,219.12,461.521,282.962,446.946,333.962z"/> <path class="st0" d="M221.561,59.204c1.95-57.344-62.903-66.302-86.04-54.9C141.55,70.436,192.007,71.892,221.561,59.204z"/></g></svg>'
      const encodedFruit = svgToDataUrl(fruitIcon);
      const vegIcon = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><svg height="800px" width="800px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 viewBox="0 0 512 512"  xml:space="preserve"><style type="text/css">	.st0{fill:#000000;}</style><g>	<path class="st0" d="M452.762,145.38c-42.12-1.683-121.506,53.426-147.52,70.052c-22.621,19.972-29.251,6.016-17.532-5.69		c16.207-16.173,30.217-37.233,96.573-69.491c33.279-16.18,44.181-23.736,33.042-35.165c-11.144-11.442-40.024,1.304-32.698-7.671		c7.313-8.996,17.532-42.633,6.238-50.926c-11.28-8.272-40.301,11.564-46.688,21.242c-6.366,9.679-2.872-21.694-17.126-28.893		c-14.247-7.191-18.18,5.461-23.641,42.059c-10.875,72.979-26.764,92.666-37.328,112.983c-7.657,14.687-22.952,12.53-10.685-15.031		c8.056-29.799,36.834-122.059,22.587-161.732c-14.241-39.672-50.128-1.075-40.41,22.29c-27.866-25.974-35.253,15.612-10.713,61.043		c5.833,10.814,17.998,54.785-4.947,102.318c-11.821-6.941-29.501-12.497-47.702-5.853c-19.681,7.279-35.05,16.166-47.155,25.831		c-6.319,5.056-11.773,10.334-16.518,15.781c-23.898,27.095-29.44,57.11-36.888,75.256c-1.939,4.663-4.028,10.685-6.15,17.627		c-2.176,6.9-4.44,14.68-6.712,22.985c-9.151,33.279-18.322,73.676-21.836,91.268c-7.023,34.942,6.002,48.791,17.139,56.961		c11.185,8.212,28.305,16.485,59.53-0.696c23.344-12.909,91.572-52.98,115.355-72.695c4.319-3.602,9.665-7.326,15.47-11.564		c5.813-4.238,12.05-8.935,18.33-14.443c22.215-19.505,44.83-49.425,47.58-104.926c0.831-19.37-9.712-34.53-19.891-43.748		c38.463-36.145,84.056-37.74,96.127-35.408c50.689,9.78,88.159-9.726,55.014-28.528C468.82,192.879,494.874,147.069,452.762,145.38		z M244.328,381.361c-1.466,1.291-2.933,2.419-4.4,3.623l-38.862-28.528c-5.447-3.988-12.862-3.163-16.544,1.859		c-3.643,4.961-2.211,12.286,3.23,16.281l33.468,24.554c-3.561,2.602-7.008,5.136-10.138,7.752		c-21.641,17.944-87.49,56.772-111.26,69.917c-18.356,10.09-23.553,6.272-27.352,3.487c-3.778-2.778-8.941-6.562-4.812-27.128		c3.184-15.944,10.807-49.642,18.843-79.927l14.233,10.442c5.447,4.002,12.855,3.163,16.491-1.798		c3.684-5.022,2.258-12.334-3.19-16.329l-21.08-15.484c0.879-2.967,1.744-5.9,2.609-8.617c1.899-6.19,3.73-11.469,5.339-15.349		c2.062-5.035,3.866-10.401,5.766-16.072c5.508-16.443,11.746-35.084,26.75-52.102c0.467-0.527,1.007-1.02,1.48-1.541l52.129,38.253		c5.447,3.988,12.794,3.116,16.471-1.899c3.649-4.968,2.278-12.24-3.17-16.241l-48.054-35.266		c9.726-6.819,21.073-12.747,33.996-17.518c11.476-4.19,22.607,3.346,24.723,4.9l60.022,44.045		c2.981,2.19,12.659,10.246,12.159,22.06C280.763,343.419,261.15,366.601,244.328,381.361z"/></g></svg>'
      const encodedVeg = svgToDataUrl(vegIcon)
      const oilIcon = '<?xml version="1.0" encoding="iso-8859-1"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><svg fill="#000000" height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 viewBox="0 0 512 512" xml:space="preserve"><g>	<g>		<path d="M331.533,137.042L298.667,97.6V8.533c0-4.717-3.821-8.533-8.533-8.533h-68.267c-4.713,0-8.533,3.817-8.533,8.533V97.6			l-32.875,39.45c-10.275,12.342-18.325,34.625-18.325,50.742v272.967c0,28.258,22.95,51.242,51.158,51.242h85.417			c28.208,0,51.158-22.983,51.158-51.242V187.792C349.867,171.675,341.813,149.383,331.533,137.042z M230.4,17.067h51.2v25.6h-51.2			V17.067z M332.8,460.758c0,18.842-15.292,34.175-34.092,34.175h-85.417c-18.8,0-34.092-15.333-34.092-34.175V187.792			c0-12.225,6.583-30.467,14.371-39.817l34.85-41.817c1.279-1.533,1.979-3.467,1.979-5.467V59.733h51.2v40.958			c0,2,0.7,3.933,1.979,5.467l34.846,41.808c7.792,9.358,14.375,27.592,14.375,39.825V460.758z"/>	</g></g><g>	<g>		<path d="M256,221.867c-29.187,0-51.2,44.025-51.2,102.4c0,58.375,22.013,102.4,51.2,102.4s51.2-44.025,51.2-102.4			C307.2,265.892,285.187,221.867,256,221.867z M256,409.6c-16.112,0-34.133-36.492-34.133-85.333			c0-48.842,18.021-85.333,34.133-85.333s34.133,36.492,34.133,85.333C290.133,373.108,272.112,409.6,256,409.6z"/>	</g></g></svg>'
      const encodedOil = svgToDataUrl(oilIcon);
      const meatIcon = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><svg height="800px" width="800px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 viewBox="0 0 512 512"  xml:space="preserve"><style type="text/css">	.st0{fill:#000000;}</style><g>	<path class="st0" d="M511.904,253.069c-1.554-48.548-44.377-84.942-104.409-88.656c-120.865-7.486-109.51-67.345-209.664-73.722		c-5.642-0.361-11.206-0.536-16.662-0.536c-102.294,0-171.103,61.839-180.098,137.418c-0.548,4.591-0.839,9.124-0.968,13.612H0		v52.824h0.31c3.218,66.926,53.423,119.234,135.051,121.51c48.123,1.342,182.039,5.082,224.552,6.268		c69.628,1.94,136.722-44.738,149.856-104.255c0.87-3.94,1.419-7.815,1.767-11.639H512v-52.824H511.904z M483.976,270.015		c-10.169,46.098-63.947,83.595-119.866,83.595c-1.154,0-2.308-0.02-3.462-0.046l-56.247-1.574l-168.305-4.694		c-36.877-1.032-66.784-13.638-86.496-36.458c-18.042-20.898-25.967-49.361-22.304-80.144		c7.996-67.196,71.272-114.127,153.874-114.127c4.913,0,9.956,0.162,14.985,0.484c40.514,2.579,58.118,14.489,80.41,29.578		c27.553,18.642,58.788,39.779,129.299,44.144c29.797,1.844,54.784,13.387,68.557,31.655		C484.569,235.897,487.877,252.353,483.976,270.015z"/>	<path class="st0" d="M338.827,236.587l-101.03-7.222c-10.969-0.786-20.957-6.596-27.05-15.746l-27.257-40.882		c-3.037-4.553-9.182-5.784-13.734-2.747c-4.553,3.037-5.784,9.182-2.747,13.734l12.522,18.784		c5.474,8.215,7.287,18.338,5.004,27.946c-2.283,9.608-8.454,17.829-17.043,22.704l-38.947,22.104		c-4.759,2.702-6.43,8.744-3.728,13.502c2.702,4.759,8.744,6.43,13.502,3.728l69.48-39.431c6.1-3.469,13.09-5.043,20.086-4.546		l109.535,7.828c5.455,0.387,10.188-3.72,10.582-9.176C348.39,241.714,344.289,236.974,338.827,236.587z"/></g></svg>'
      const encodedMeat = svgToDataUrl(meatIcon);
      const dairyIcon = '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><svg height="800px" width="800px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 viewBox="0 0 512 512"  xml:space="preserve"><style type="text/css">	.st0{fill:#000000;}</style><g>	<path class="st0" d="M362.662,420.313c7.068,6.361,16.659,10.176,27.12,10.176c10.458,0,20.046-3.815,27.114-10.176		c7.064-6.325,11.658-15.419,11.651-25.502c0.007-10.089-4.587-19.176-11.651-25.508c-7.068-6.353-16.659-10.161-27.114-10.161		c-10.461,0-20.049,3.808-27.12,10.161c-7.064,6.333-11.654,15.419-11.648,25.508C351.008,404.894,355.598,413.988,362.662,420.313z		 M373.037,380.828c4.158-3.75,10.075-6.188,16.746-6.188c6.672,0,12.585,2.438,16.739,6.188c4.165,3.771,6.517,8.64,6.52,13.983		c-0.004,5.345-2.355,10.206-6.52,13.984c-4.154,3.75-10.071,6.195-16.739,6.195c-6.671,0-12.588-2.445-16.746-6.195		c-4.165-3.779-6.513-8.64-6.519-13.984C366.524,389.468,368.872,384.599,373.037,380.828z"/>	<path class="st0" d="M255.638,402.795c9.39,0,18.012-3.418,24.376-9.145c6.36-5.698,10.518-13.918,10.511-23.034		c0.008-9.124-4.15-17.352-10.515-23.05c-6.364-5.726-14.986-9.138-24.372-9.138c-9.39,0-18.012,3.411-24.377,9.138		c-6.36,5.698-10.518,13.926-10.511,23.05c-0.008,9.116,4.15,17.337,10.511,23.034C237.625,399.377,246.247,402.795,255.638,402.795		z M241.632,359.091c3.458-3.115,8.402-5.164,14.006-5.164c5.604,0,10.547,2.048,14.006,5.164c3.454,3.144,5.372,7.14,5.38,11.525		c-0.008,4.37-1.926,8.373-5.384,11.517c-3.454,3.116-8.402,5.164-14.002,5.164c-5.6,0-10.548-2.049-14.002-5.164		c-3.462-3.144-5.376-7.146-5.384-11.517C236.259,366.231,238.173,362.235,241.632,359.091z"/>	<path class="st0" d="M345.844,120.773c-7.8-3.159-16.89-4.904-26.62-4.904c-12.97,0.014-24.804,3.08-33.972,8.553		c-4.576,2.747-8.514,6.13-11.434,10.262c-2.913,4.112-4.76,9.088-4.749,14.374c-0.01,5.286,1.836,10.262,4.746,14.374		c4.399,6.188,11.002,10.746,18.784,13.926c7.806,3.159,16.898,4.912,26.626,4.912c12.971-0.022,24.81-3.087,33.976-8.561		c4.573-2.755,8.514-6.144,11.435-10.277c2.91-4.111,4.756-9.087,4.745-14.374c0.011-5.286-1.835-10.262-4.749-14.374		C360.232,128.504,353.629,123.954,345.844,120.773z M351.96,154.503c-2.041,2.949-6.188,6.173-11.939,8.488		c-5.73,2.329-12.956,3.786-20.796,3.786c-10.45,0.015-19.811-2.618-25.995-6.361c-3.097-1.854-5.365-3.952-6.74-5.914		c-1.377-1.99-1.907-3.7-1.918-5.445c0.01-1.745,0.537-3.455,1.918-5.438c2.038-2.95,6.184-6.166,11.94-8.474		c5.73-2.336,12.956-3.779,20.795-3.779c10.451-0.021,19.819,2.611,26,6.339c3.094,1.86,5.365,3.952,6.736,5.914		c1.381,1.983,1.908,3.692,1.914,5.438C353.868,150.803,353.338,152.513,351.96,154.503z"/>	<path class="st0" d="M255.782,209.963c-5.903-2.769-12.754-4.291-20.056-4.299c-9.736,0.022-18.679,2.683-25.631,7.486		c-3.469,2.402-6.451,5.38-8.626,8.95c-2.174,3.541-3.501,7.731-3.494,12.13c-0.007,4.392,1.316,8.59,3.49,12.138		c3.282,5.344,8.308,9.36,14.197,12.137c5.906,2.762,12.758,4.292,20.064,4.292c9.736-0.015,18.675-2.683,25.628-7.479		c3.469-2.416,6.452-5.387,8.629-8.95c2.174-3.548,3.494-7.746,3.49-12.138c0.004-4.399-1.32-8.59-3.494-12.13		C266.7,216.749,261.674,212.725,255.782,209.963z M256.744,238.298c-1.273,2.128-3.851,4.457-7.54,6.181		c-3.668,1.716-8.355,2.82-13.479,2.82c-6.833,0.007-12.888-1.983-16.793-4.724c-1.962-1.356-3.372-2.863-4.23-4.277		c-0.862-1.436-1.219-2.712-1.226-4.068c0.007-1.356,0.364-2.632,1.226-4.068c1.273-2.12,3.851-4.45,7.54-6.173		c3.671-1.724,8.359-2.827,13.483-2.82c6.83-0.014,12.888,1.984,16.789,4.717c1.962,1.356,3.372,2.856,4.23,4.277		c0.862,1.436,1.215,2.712,1.222,4.068C257.959,235.587,257.606,236.863,256.744,238.298z"/>	<path class="st0" d="M511.949,291.14c-2.517-29.461-8.546-55.676-17.085-79.007l-4.035-11.027l-11.565,1.976		c-2.906,0.498-5.848,0.772-8.845,0.772c-10.447,0.029-19.671-3.086-25.505-7.248c-2.935-2.055-4.998-4.313-6.228-6.376		c-1.237-2.084-1.716-3.887-1.727-5.784c0.022-2.597,0.916-5.192,3.527-8.243c2.578-2.993,6.924-6.058,12.57-8.164l17.583-6.606		l-11.255-15.03c-25.22-33.702-56.332-56.39-85.608-72.314c-29.26-15.924-56.935-25.256-75.221-32.021		c-7.583-2.806-14.839-4.068-21.491-4.06c-13.072-0.021-23.32,4.825-29.872,9.578c-4.936,3.57-8.03,7.053-9.548,8.964		L119.927,170.384l4.991,9.376c1.741,3.282,2.643,6.664,2.65,10.27c-0.018,6.484-2.831,12.412-8.056,17.164		c-5.211,4.702-12.722,7.839-21.272,7.832c-3.974,0-7.717-0.692-11.193-1.933l-8.24-2.942L0,286.366v137.582		c0.007,27.65,22.4,50.036,50.047,50.043h45.407l-1.598-15.534c-0.091-0.88-0.134-1.601-0.134-2.206		c0.018-7.003,3.065-13.4,8.661-18.492c5.586-5.034,13.616-8.38,22.739-8.373c9.116-0.007,17.146,3.339,22.732,8.373		c5.596,5.091,8.644,11.488,8.661,18.492c0,0.548-0.043,1.312-0.14,2.329l-1.453,15.412h307.03		c27.647-0.007,50.04-22.393,50.048-50.043V291.746L511.949,291.14z M86.399,242.02c3.826,0.75,7.778,1.19,11.842,1.19		c15.43-0.008,29.63-5.625,40.131-15.073c10.493-9.39,17.398-23.006,17.38-38.108c0.004-4.602-0.696-9.037-1.882-13.262		L258.966,75.129l0.688-0.988c0.329-0.419,2.2-2.604,5.15-4.45c3.007-1.868,6.844-3.476,12.261-3.497		c3.17,0.007,6.991,0.569,11.723,2.315c18.841,6.937,44.688,15.736,71.516,30.333c22.862,12.447,46.222,29.057,66.361,52.019		c-2.676,2.077-5.221,4.299-7.439,6.837c-6.26,7.118-10.476,16.509-10.454,26.75c-0.01,7.349,2.171,14.366,5.752,20.294		c5.398,8.936,13.649,15.614,23.255,20.208c9.635,4.579,20.781,7.082,32.641,7.096c0.443,0,0.865-0.05,1.308-0.065		c4.832,15.152,8.507,31.696,10.757,49.798H45.287L86.399,242.02z M483.816,423.948c-0.008,6.08-2.428,11.46-6.404,15.455		c-3.995,3.981-9.376,6.397-15.459,6.404H183.586c-2.372-11.388-8.495-21.491-16.872-28.992		c-10.876-9.787-25.592-15.606-41.592-15.614c-16.006,0.007-30.722,5.827-41.602,15.614c-8.376,7.501-14.492,17.604-16.868,28.992		H50.047c-6.083-0.008-11.463-2.423-15.458-6.404c-3.978-3.995-6.397-9.375-6.404-15.455v-121.03h455.632V423.948z"/></g></svg>'
      const encodedDairy = svgToDataUrl(dairyIcon);
      const cannedIcon = '<?xml version="1.0" encoding="iso-8859-1"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 width="800px" height="800px" viewBox="0 0 496.531 496.53"	 xml:space="preserve"><g>	<g>		<path d="M247.437,23.872c-65.733,0-117.209,22.782-117.209,51.863s51.476,51.863,117.209,51.863			c65.72,0,117.202-22.782,117.202-51.863C364.644,46.654,313.157,23.872,247.437,23.872z M247.437,116.047			c-62.273,0-105.667-21.247-105.667-40.317c0-19.067,43.395-40.312,105.667-40.312c62.261,0,105.655,21.244,105.655,40.312			C353.097,94.805,309.698,116.047,247.437,116.047z"/>		<path d="M179.335,76.414c0,18.892,33.248,28.779,66.093,28.779c32.851,0,66.1-9.887,66.1-28.779			C311.528,38.634,179.335,38.634,179.335,76.414z M245.428,93.643c-33.3,0-54.542-10.205-54.542-17.229			c0-7.026,21.242-17.229,54.542-17.229c33.304,0,54.553,10.202,54.553,17.229C299.981,83.438,278.732,93.643,245.428,93.643z"/>		<path d="M312.097,277.616c-1.615,0.821-2.796,1.241-3.533,1.241c-1.479,0-2.039-1.055-1.666-3.183			c0.364-2.128,1.125-4.756,2.291-7.901c1.148-3.137,2.428-6.571,3.809-10.318c1.382-3.743,2.399-7.179,3.048-10.324			c0.644-3.136,0.63-5.775-0.07-7.894c-0.69-2.122-2.516-3.192-5.475-3.192c-2.403,0-4.644,0.807-6.725,2.424			c-2.072,1.624-4.037,3.718-5.881,6.301l2.632-8.725h-12.61l-11.308,37.801c-0.99,1.773-2.11,3.183-3.44,3.985			c-1.624,0.971-2.936,1.316-3.948,1.036c-0.742-0.182-1.25-0.756-1.525-1.727s0.135-3.216,1.246-6.721			c0.555-1.849,1.391-4.602,2.492-8.242c1.101-3.649,2.221-7.332,3.322-11.015c1.298-4.34,2.68-8.968,4.154-13.861			c-3.043-1.386-6.441-1.893-10.184-1.519c-3.734,0.371-7.477,1.519-11.225,3.465c-3.738,1.939-7.273,4.644-10.602,8.107			c-3.32,3.458-6.055,7.645-8.176,12.535c-1.008,2.292-1.848,4.425-2.562,6.445c-3.11,4.541-6.35,8.76-9.768,12.405			c-1.848,1.941-3.813,3.831-5.888,5.68c-2.079,1.853-4.247,3.51-6.513,4.984c-2.261,1.479-4.569,2.665-6.921,3.538			c-2.354,0.877-4.739,1.315-7.138,1.315c-3.51,0-6.219-1.409-8.107-4.228c-1.892-2.811-3.16-6.558-3.808-11.22			c-0.656-4.663-0.656-9.96,0-15.868c0.648-5.909,1.801-11.985,3.465-18.225c1.666-6.235,3.759-12.3,6.303-18.223			c2.532-5.906,5.449-11.196,8.728-15.866c3.283-4.66,6.886-8.401,10.813-11.222c3.92-2.819,8.053-4.228,12.403-4.228			c3.043,0,5.281,0.539,6.714,1.601c1.435,1.062,2.242,2.331,2.429,3.813c0.18,1.477-0.187,3.045-1.104,4.697			c-0.929,1.668-2.219,3.123-3.885,4.364c-1.664,1.253-3.624,2.156-5.895,2.705c-2.254,0.555-4.684,0.417-7.269-0.416			c0.46,1.76,1.199,3.375,2.214,4.852c0.922,1.3,2.168,2.527,3.741,3.68c1.568,1.15,3.694,1.825,6.38,2.002			c4.518,0.469,8.422-0.091,11.705-1.654c3.283-1.583,5.82-3.654,7.616-6.235c1.802-2.59,2.89-5.435,3.263-8.527			c0.374-3.087-0.093-5.997-1.382-8.728c-1.297-2.728-3.428-5.017-6.377-6.855c-2.954-1.851-6.844-2.777-11.638-2.777			c-6.38,0-12.592,1.615-18.638,4.85c-6.056,3.236-11.688,7.514-16.904,12.813c-5.223,5.325-9.906,11.369-14.06,18.158			c-4.163,6.79-7.584,13.723-10.256,20.782c-2.681,7.066-4.501,13.982-5.477,20.713c-0.971,6.758-0.856,12.778,0.345,18.089			c1.199,5.312,3.577,9.582,7.133,12.825c3.562,3.221,8.569,4.845,15.035,4.845c3.603,0,7.063-0.527,10.396-1.597			c3.325-1.055,6.466-2.492,9.423-4.284c2.95-1.801,5.722-3.808,8.312-6.029c2.581-2.222,4.94-4.522,7.068-6.926			c1.878-2.054,3.589-4.304,5.295-6.567c-0.334,2.301-0.502,4.411-0.306,6.082c0.277,2.343,1.017,4.102,2.217,5.264			c1.199,1.148,2.681,1.728,4.436,1.728c2.495,0,5.041-0.714,7.621-2.143c2.59-1.433,4.856-3.169,6.793-5.199			c0.177,2.959,1.017,4.915,2.487,5.886c1.479,0.971,3.057,1.456,4.719,1.456c1.194,0,2.557-0.271,4.078-0.831			c1.526-0.556,3.095-1.461,4.71-2.697c1.339-1.036,2.585-2.474,3.831-3.99l-2.38,7.938h12.61l8.728-29.095			c0.653-1.577,1.339-3.188,2.086-4.863c0.732-1.656,1.479-3.154,2.217-4.494c0.737-1.344,1.521-2.45,2.353-3.328			c0.83-0.877,1.614-1.315,2.361-1.315c1.013,0,1.241,1.073,0.687,3.192c-0.556,2.128-1.415,4.751-2.562,7.887			c-1.148,3.146-2.371,6.562-3.669,10.259c-1.297,3.696-2.174,7.122-2.632,10.253c-0.467,3.146-0.289,5.773,0.551,7.906			c0.831,2.114,2.81,3.179,5.955,3.179c1.195,0,2.562-0.271,4.089-0.831c1.521-0.556,3.089-1.461,4.704-2.697			c1.614-1.251,3.164-2.866,4.644-4.854c1.475-1.987,2.768-4.405,3.888-7.271h-1.941			C315.075,275.171,313.711,276.785,312.097,277.616z M256.334,270.41c-0.56,1.662-0.971,3.179-1.255,4.569			c-0.738,0.556-1.662,1.186-2.768,1.871c-1.111,0.7-2.128,1.041-3.055,1.041c-1.2,0-1.911-0.845-2.147-2.562			c-0.229-1.717-0.091-3.883,0.422-6.52c0.506-2.628,1.332-5.446,2.49-8.447c1.155-3.001,2.427-5.82,3.806-8.462			c1.391-2.627,2.87-4.802,4.447-6.506c1.563-1.712,3.085-2.569,4.56-2.569c0.561,0,1.111,0.1,1.671,0.282L256.334,270.41z"/>		<path d="M401.206,288.416V77.947C401.206,34.237,334,0,248.205,0C162.412,0,95.204,34.237,95.204,77.947V418.59			c0,43.707,67.208,77.94,153.001,77.94c85.79,0,153.001-34.237,153.001-77.94V289.788c0.019-0.452,0.121-0.9,0.121-1.362h-0.121			V288.416z M389.66,418.59c0,35.993-64.779,66.395-141.455,66.395c-76.675,0-141.455-30.401-141.455-66.395V311.191			c17.303,17.502,54.252,30.924,102.018,35.838c-0.654,1.186-1.181,2.399-1.725,3.622c-3.125,6.249-4.966,13.124-4.966,20.433			c0,27.321,24.341,49.551,54.271,49.551c22.924,0,42.479-13.092,50.408-31.484c3.021-6.161,4.771-12.928,4.771-20.105			c0-8.41-2.441-16.689-7.011-24.055c39.74-5.965,69.703-17.763,85.133-32.716V418.59H389.66z M214.527,369.035			c0-4.947,1.253-9.764,3.421-14.328c6.903-12.75,21.445-21.641,38.401-21.641c23.559,0,42.722,17.049,42.722,38.013			c0,4.761-1.101,9.278-2.907,13.479c-6.688,13.213-21.576,22.486-38.909,22.486C233.697,407.034,214.527,389.99,214.527,369.035z			 M389.66,289.415c-1.312,19.802-41.435,38.802-96.497,45.457h-0.019c-9.689-8.214-22.561-13.353-36.791-13.353			c-15.053,0-28.684,5.638-38.529,14.72c-63.026-5.11-110.353-25.524-110.353-47.813h-0.716V108.143			c22.733,28.292,76.799,47.747,141.455,47.747c64.657,0,118.721-19.45,141.45-47.747V289.415L389.66,289.415z M248.205,144.339			c-76.675,0-141.455-30.399-141.455-66.396c0-35.995,64.779-66.396,141.455-66.396c76.676,0,141.455,30.401,141.455,66.396			C389.66,113.944,324.88,144.339,248.205,144.339z"/>		<polygon points="116.292,386.388 118.133,433.03 120.756,434.248 118.917,387.592 		"/>		<polygon points="146.927,400.52 148.751,447.148 151.396,448.366 149.561,401.724 		"/>		<polygon points="122.553,389.285 124.375,435.914 125.699,436.53 123.864,389.883 		"/>		<polygon points="150.651,402.246 152.49,448.861 153.808,449.458 151.983,402.844 		"/>		<polygon points="142.754,398.597 144.586,445.229 145.909,445.827 144.075,399.203 		"/>		<polygon points="136.26,395.591 138.101,442.243 139.434,442.84 137.592,396.216 		"/>		<polygon points="127.152,391.399 128.996,438.047 131.614,439.242 129.785,392.618 		"/>		<polygon points="138.682,396.711 140.533,443.358 143.161,444.539 141.317,397.924 		"/>		<polygon points="130.673,393.023 132.499,439.662 133.824,440.269 131.987,393.631 		"/>		<polygon points="154.172,403.861 156.011,450.485 157.327,451.082 155.5,404.468 		"/>		<polygon points="158.774,405.956 160.611,452.604 163.252,453.812 161.427,407.207 		"/>		<polygon points="162.298,407.576 164.136,454.229 165.45,454.854 163.621,408.196 		"/>	</g></g></svg>'
      const encodedCanned = svgToDataUrl(cannedIcon);
      const dryIcon = '<?xml version="1.0" encoding="iso-8859-1"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg fill="#000000" height="800px" width="800px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 	 viewBox="0 0 55 55" xml:space="preserve"><g>	<circle cx="47" cy="47.5" r="1"/>	<circle cx="45" cy="44.5" r="1"/>	<circle cx="43" cy="41.5" r="1"/>	<circle cx="47" cy="41.5" r="1"/>	<circle cx="41" cy="38.5" r="1"/>	<circle cx="45" cy="38.5" r="1"/>	<circle cx="39" cy="35.5" r="1"/>	<circle cx="43" cy="35.5" r="1"/>	<circle cx="49" cy="50.5" r="1"/>	<circle cx="45" cy="50.5" r="1"/>	<circle cx="43" cy="47.5" r="1"/>	<circle cx="41" cy="44.5" r="1"/>	<circle cx="39" cy="41.5" r="1"/>	<circle cx="37" cy="38.5" r="1"/>	<circle cx="39" cy="47.5" r="1"/>	<circle cx="37" cy="44.5" r="1"/>	<circle cx="35" cy="41.5" r="1"/>	<circle cx="41" cy="50.5" r="1"/>	<circle cx="37" cy="50.5" r="1"/>	<circle cx="35" cy="47.5" r="1"/>	<circle cx="33" cy="44.5" r="1"/>	<circle cx="31" cy="47.5" r="1"/>	<circle cx="33" cy="50.5" r="1"/>	<circle cx="29" cy="50.5" r="1"/>	<path d="M53.374,45.686c-1.015-1.256-2.436-3.569-3.809-5.807c-1.439-2.346-2.8-4.562-3.847-5.855		c-1.63-2.011-3.631-3.239-5.719-3.478V1.5c0-0.553-0.448-1-1-1H8.006c-0.005,0-0.01,0.003-0.015,0.003S7.981,0.5,7.976,0.5H1		c-0.552,0-1,0.447-1,1v46c0,0.399,0.238,0.761,0.605,0.919l6.976,3C7.708,51.473,7.842,51.5,7.976,51.5		c0.006,0,0.012-0.002,0.018-0.002c0.005,0,0.008,0.002,0.013,0.002H23.47c0.058,0.26,0.136,0.514,0.257,0.752		c0.523,1.025,1.861,2.248,5.261,2.248h18.16c3.774,0,6.498-1.169,7.471-3.207C55.406,49.644,54.964,47.653,53.374,45.686z		 M6.976,48.981L2,46.842V2.5h4.976V48.981z M9.006,2.5H38V30.6c-0.268,0.046-0.533,0.109-0.796,0.187		c-0.071,0.021-0.141,0.051-0.211,0.074c-0.203,0.067-0.406,0.138-0.605,0.224c-0.1,0.043-0.197,0.094-0.295,0.141		c-0.168,0.081-0.335,0.164-0.499,0.258c-0.104,0.059-0.206,0.124-0.308,0.188c-0.156,0.098-0.309,0.201-0.461,0.311		c-0.101,0.073-0.202,0.148-0.301,0.227c-0.151,0.119-0.298,0.245-0.444,0.375c-0.093,0.083-0.187,0.164-0.278,0.252		c-0.156,0.15-0.306,0.31-0.456,0.473c-0.075,0.082-0.152,0.158-0.225,0.243c-0.219,0.254-0.433,0.52-0.637,0.803		c-0.898,1.244-1.995,3.129-3.169,5.2c-0.241,0.425-0.484,0.854-0.731,1.292c-0.452,0.801-0.908,1.607-1.354,2.384		c-0.922,1.604-1.803,3.076-2.509,4.05c-0.013,0.018-0.022,0.035-0.035,0.053c-0.141,0.197-0.269,0.392-0.388,0.585		c-0.035,0.058-0.066,0.116-0.099,0.174c-0.091,0.158-0.176,0.315-0.252,0.471c-0.029,0.059-0.055,0.118-0.082,0.177		c-0.07,0.155-0.132,0.309-0.187,0.461c-0.02,0.055-0.041,0.111-0.059,0.166c-0.014,0.043-0.033,0.088-0.046,0.131H9.006V2.5z		 M28.988,52.5c-1.836,0-3.104-0.422-3.479-1.156c0-0.001,0-0.002,0-0.002C25.797,51.166,26,50.863,26,50.5		c0-0.315-0.155-0.585-0.384-0.768c0.016-0.038,0.025-0.074,0.042-0.113c0.012-0.028,0.027-0.057,0.04-0.086		c0.064-0.139,0.139-0.282,0.223-0.427c0.022-0.038,0.042-0.076,0.066-0.114c0.105-0.175,0.221-0.353,0.352-0.535		c0.033-0.046,0.069-0.101,0.103-0.148C26.604,48.419,26.789,48.5,27,48.5c0.552,0,1-0.448,1-1c0-0.358-0.199-0.658-0.482-0.835		c0.274-0.444,0.557-0.915,0.848-1.409C28.539,45.402,28.755,45.5,29,45.5c0.552,0,1-0.448,1-1c0-0.432-0.277-0.791-0.66-0.931		c0.08-0.141,0.161-0.282,0.241-0.424c0.205-0.361,0.409-0.722,0.613-1.083C30.375,42.32,30.661,42.5,31,42.5c0.552,0,1-0.448,1-1		c0-0.528-0.412-0.948-0.93-0.986c0.334-0.589,0.665-1.167,0.989-1.723C32.185,39.198,32.551,39.5,33,39.5c0.552,0,1-0.448,1-1		s-0.448-1-1-1c-0.071,0-0.134,0.026-0.201,0.041c0.445-0.735,0.86-1.383,1.229-1.904C34.097,36.121,34.496,36.5,35,36.5		c0.552,0,1-0.448,1-1s-0.448-1-1-1c-0.013,0-0.024,0.007-0.037,0.007c0.268-0.277,0.541-0.538,0.827-0.76		c0.184-0.143,0.371-0.271,0.561-0.39c0.018-0.011,0.035-0.026,0.053-0.037c0.834-0.512,1.722-0.793,2.624-0.818		c0.002,0,0.003-0.001,0.004-0.001c0.044-0.001,0.088-0.002,0.132-0.002c1.771,0,3.542,0.984,5,2.784		c0.966,1.191,2.354,3.454,3.697,5.642c0.579,0.944,1.165,1.896,1.732,2.79C49.425,43.589,49.227,43.5,49,43.5c-0.552,0-1,0.448-1,1		s0.448,1,1,1s1-0.448,1-1c0-0.076-0.027-0.142-0.043-0.213c0.628,0.973,1.219,1.837,1.741,2.5C51.517,46.61,51.272,46.5,51,46.5		c-0.552,0-1,0.448-1,1s0.448,1,1,1s1-0.448,1-1c0-0.256-0.103-0.483-0.261-0.66c0.026,0.033,0.055,0.073,0.081,0.104		c0.748,0.925,1.138,1.802,1.167,2.559C52.441,49.511,52,49.953,52,50.5c0,0.248,0.1,0.467,0.249,0.642		C51.295,52,49.488,52.5,47.148,52.5H28.988z"/>	<path d="M21,25.727c0.552,0,1-0.447,1-1v-3.658c0-0.149-0.012-0.296-0.022-0.442l0.308,0.308c0.195,0.195,0.451,0.293,0.707,0.293		s0.512-0.098,0.707-0.293l0.324-0.324C24.012,20.763,24,20.914,24,21.069v3.658c0,0.553,0.448,1,1,1h3.658		c3.497,0,6.342-2.845,6.342-6.341v-3.659c0-0.553-0.448-1-1-1h-3.658c-0.828,0-1.617,0.164-2.343,0.454		c0.428-2.029-0.14-4.229-1.713-5.802l-2.587-2.587c-0.391-0.391-1.023-0.391-1.414,0L19.698,9.38		c-1.571,1.571-2.14,3.768-1.714,5.795c-0.721-0.286-1.504-0.448-2.326-0.448H12c-0.552,0-1,0.447-1,1v3.659		c0,3.496,2.845,6.341,6.342,6.341H21z M33,16.727v2.659c0,2.394-1.948,4.341-4.342,4.341H26v-2.658		c0-2.395,1.948-4.342,4.342-4.342H33z M21.112,10.794l1.88-1.88l1.88,1.88c1.692,1.692,1.692,4.447,0,6.14l-1.88,1.88l-1.88-1.88		C19.42,15.241,19.42,12.486,21.112,10.794z M13,19.387v-2.659h2.658c2.394,0,4.342,1.947,4.342,4.342v2.658h-2.658		C14.948,23.727,13,21.78,13,19.387z"/>	<path d="M32,32.5c0-0.553-0.448-1-1-1H16c-0.552,0-1,0.447-1,1s0.448,1,1,1h15C31.552,33.5,32,33.053,32,32.5z"/>	<path d="M19,28.5c-0.552,0-1,0.447-1,1s0.448,1,1,1h10c0.552,0,1-0.447,1-1s-0.448-1-1-1H19z"/>	<path d="M30,35.5c0-0.553-0.448-1-1-1H19c-0.552,0-1,0.447-1,1s0.448,1,1,1h10C29.552,36.5,30,36.053,30,35.5z"/></g></svg>'
      const encodedDry = svgToDataUrl(dryIcon);
      const unkIcon = '<svg width="500" height="500" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M285.208 303.334L352.083 272.917L418.75 303.334M285.208 303.334L352.083 333.75M285.208 303.334V387.917L352.083 418.334L418.75 387.917V303.334M352.083 333.75L418.75 303.334M352.083 333.75V414.167M310.417 437.5H122.917C111.866 437.5 101.268 433.11 93.4539 425.296C85.6398 417.482 81.25 406.884 81.25 395.833V104.167C81.25 93.116 85.6398 82.5182 93.4539 74.7042C101.268 66.8902 111.866 62.5 122.917 62.5H310.417C321.467 62.5 332.065 66.8902 339.879 74.7042C347.694 82.5182 352.083 93.116 352.083 104.167V233.959M143.75 137.5H289.583M143.75 205.209H289.583M143.75 272.917H235.625" stroke="#EC9192" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/></svg>'
      const encodedUnk = svgToDataUrl(unkIcon);
      
      
     
      try {

        const itemIndex = [icons];
        var indexCounter = 0;
        icons.forEach(item => {
          var thisIndex = indexCounter;
          console.log(indexCounter);
          console.log("Item: " + item.name + " and index: "+ thisIndex);
          const card = document.createElement('div');
          card.className = 'icon-card';
          if (item.category == 'fruits'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedFruit}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else if (item.category == 'vegetables'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedVeg}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else if (item.category == 'oil'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedOil}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else if (item.category == 'meat'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedMeat}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else if (item.category == 'dairy'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedDairy}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else if (item.category == 'canned_goods'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedCanned}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else if (item.category == 'dry_goods'){
            card.innerHTML = `
            <img class="icon-img" src="${encodedDry}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          else {
            card.innerHTML = `
            <img class="icon-img" src="${encodedUnk}" alt="${item.name} icon">
            <div class="info"><strong>${item.name}</strong></div>
            <div class="info">${item.amount} ${item.units}</div>
            <div class="info">${item.category}</div>
          `;
          }
          card.addEventListener('click', () => openModal(thisIndex));
          console.log('opening modal numer'+thisIndex);
          iconArea.appendChild(card);
          indexCounter = indexCounter + 1;
        });
        
      }
      catch (error) {
        console.error('Error displaying cards', error);
      }
    } 

    

    async function getItemByIndex(index){
      try{
        const userData = JSON.parse(sessionStorage.getItem('userData'));

        const response = await fetch('http://127.0.0.1:5000/pantry/getByIndex', {
            method: "GET",
            headers: {
                'Content-Type': 'application/json',
                'index': index,
                'User-Id': userData.id
            } 
      }); 
        const data = await response.json();
        console.log(data);
        return data;
        

      }
      catch (error){
        console.error('Error getting item', error);
        return 'error';
      }
    }

    async function deleteByIndex(index){
      try{
        const userData = JSON.parse(sessionStorage.getItem('userData'));

        const response = await fetch('http://127.0.0.1:5000/pantry/deleteByIndex', {
            method: "DELETE",
            headers: {
                'Content-Type': 'application/json',
                //'name':name, 
                //'amount':amount, 
                //'units':units, 
                //'category':category,
                'index': index,
                'User-Id': userData.id
            } 
      }); 
        const data = await response.json();
        console.log(data);
        return data;
        

      }
      catch (error){
        console.error('Error editing item', error);
        return 'error';
      }
    }

    async function editByIndex(index, name, amount, units, category){
      try{
        const userData = JSON.parse(sessionStorage.getItem('userData'));

        const response = await fetch('http://127.0.0.1:5000/pantry/editByIndex', {
            method: "POST",
            headers: {
                'Content-Type': 'application/json',
                'name':name, 
                'amount':amount, 
                'units':units, 
                'category':category,
                'index': index,
                'User-Id': userData.id
            } 
      }); 
        const data = await response.json();
        console.log(data);
        return data;
        

      }
      catch (error){
        console.error('Error editing item', error);
        return 'error';
      }
      
    }

    function svgToDataUrl(svgString) {
      const encoded = btoa(unescape(encodeURIComponent(svgString)));
      return `data:image/svg+xml;base64,${encoded}`;
    }

     async function openModal(index) {
      const item = await this.getItemByIndex(index);
      sessionStorage.setItem('currentIndex', index);
      console.log('index is:' + index);
      console.log('item is: '+item);
      
      document.getElementById('editName').value = item.name;
      document.getElementById('editAmount').value = item.amount;
      document.getElementById('editUnits').value = item.units;
      document.getElementById('editCategory').value = item.category;

      document.getElementById('editModal').style.display = 'block';
    }

    function saveChanges(){
      const index = sessionStorage.getItem('currentIndex');
      console.log("This is in the savechanges function")
      console.log(index)
      const name = document.getElementById('editName').value;
      const amount = document.getElementById('editAmount').value;
      const units = document.getElementById('editUnits').value;
      const category = document.getElementById('editCategory').value;
      
      editByIndex(index, name, amount, units, category);
      fetchIngredients();
      closeModal();
      location.reload();
    }

    function deleteItem(){
      const index = sessionStorage.getItem('currentIndex');
      console.log("This is in the delete function")
      console.log(index)
      //const name = document.getElementById('editName').value;
      //const amount = document.getElementById('editAmount').value;
      //const units = document.getElementById('editUnits').value;
      //const category = document.getElementById('editCategory').value;
      
      deleteByIndex(index);
      fetchIngredients();
      closeModal();
      location.reload();
    }


    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }



    </script>

  </body>
</html>
